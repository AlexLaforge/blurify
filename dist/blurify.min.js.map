{"version":3,"file":null,"sources":["../src/utils.js","../src/index.js"],"sourcesContent":["export function preloadImages(images) {\n    let newimages = [],\n        loadedImagesCount = 0,\n        postAction = function () {};\n\n    images = (typeof images != 'object') ? [images] : images;\n\n    function imageLoadPost() {\n        loadedImagesCount++;\n        if (loadedImagesCount == images.length) postAction(newimages);\n    }\n\n    images.map((image, i) => {\n        newimages[i] = new Image();\n        newimages[i].crossOrigin = '*';\n        newimages[i].src = image.dataset ? image.dataset.src : image.getAttribute('data-src');\n        newimages[i].onload = function () {\n            imageLoadPost();\n        };\n        newimages[i].onerror = function () {\n            imageLoadPost();\n        };\n    });\n\n    return {\n        done(callback) {\n            postAction = callback || postAction;\n        },\n    };\n}\n\nexport function cssSupport(...args) {\n    let el = document.createElement('div'),\n        property = args[0],\n        value = args[1];\n    if (args.length === 1) {\n        return property in el.style ? true : false;\n    } else if (args.length === 2) {\n        el.style[property] = value;\n        return el.style[property] ? true : false;\n    } else {\n        return false;\n    }\n}\n","import {\n    preloadImages,\n    cssSupport,\n} from './utils';\n\nexport default class blurify {\n    constructor(options) {\n        this.options = options;\n        this.blur = options.blur || 6;\n        this.mode = options.mode || 'css';\n        this.$els = options.images.nodeType === 1 ? [options.images] : [].slice.call(options.images);\n\n        if (this.mode == 'auto') {\n            cssSupport('filter', 'blur(1px)') ? this.useCSSMode() : this.useCanvasMode();\n        } else if (this.mode == 'css') {\n            this.useCSSMode();\n        } else {\n            this.useCanvasMode();\n        }\n    }\n\n    useCSSMode() {\n        this.$els.map(el => {\n            el.src = el.dataset ? el.dataset.src : el.getAttribute('data-src');\n            el.style['filter'] = el.style['-webkit-filter'] = `blur(${this.options.blur}px)`;\n        });\n    }\n\n    useCanvasMode() {\n        this.imageType = this.options.imageType || `image/jpeg`;\n        preloadImages(this.$els).done(images => {\n            images.map((image, index) => {\n                this.$els[index].src = this.getDataURL(image);\n            });\n        });\n    }\n\n    blurify(canvas, blur) {\n        let ctx = canvas.getContext('2d');\n        ctx.globalAlpha = 1 / (2 * blur);\n        for (let y = -blur; y <= blur; y += 2) {\n            for (let x = -blur; x <= blur; x += 2) {\n                ctx.drawImage(canvas, x, y);\n                if (x >= 0 && y >= 0) ctx.drawImage(canvas, -(x - 1), -(y - 1));\n            }\n        }\n        ctx.globalAlpha = 1;\n    }\n\n    getDataURL(image) {\n        let canvas = document.createElement('canvas'),\n            ctx = canvas.getContext('2d');\n\n        canvas.width = image.width;\n        canvas.height = image.height;\n        ctx.drawImage(image, 0, 0);\n        this.blurify(canvas, this.blur);\n        return canvas.toDataURL(this.imageType);\n    }\n}\n"],"names":["preloadImages","images","imageLoadPost","loadedImagesCount","length","postAction","newimages","map","image","i","Image","crossOrigin","src","dataset","getAttribute","onload","onerror","callback","cssSupport","el","document","createElement","property","value","arguments","style","options","blur","mode","$els","nodeType","slice","call","this","useCSSMode","useCanvasMode","_this","imageType","done","index","_this2","getDataURL","canvas","ctx","getContext","globalAlpha","y","x","drawImage","width","height","blurify","toDataURL"],"mappings":"4LAAO,SAASA,GAAcC,WAOjBC,SAEDC,GAAqBF,EAAOG,QAAQC,EAAWC,MARnDA,MACAH,EAAoB,EACpBE,EAAa,sBAEU,oBAAVJ,gBAAAA,KAAuBA,GAAUA,IAO3CM,IAAI,SAACC,EAAOC,KACLA,GAAK,GAAIC,SACTD,GAAGE,YAAc,MACjBF,GAAGG,IAAMJ,EAAMK,QAAUL,EAAMK,QAAQD,IAAMJ,EAAMM,aAAa,cAChEL,GAAGM,OAAS,kBAGZN,GAAGO,QAAU,iCAMlBC,KACYA,GAAYZ,IAK9B,QAASa,QACRC,GAAKC,SAASC,cAAc,OAC5BC,0CACAC,gDACgB,KAAhBC,UAAKpB,OACEkB,IAAYH,GAAGM,MACC,IAAhBD,UAAKpB,WACTqB,MAAMH,GAAYC,IACdJ,EAAGM,MAAMH,okBCjCRI,kBACHA,QAAUA,OACVC,KAAOD,EAAQC,MAAQ,OACvBC,KAAOF,EAAQE,MAAQ,WACvBC,KAAmC,IAA5BH,EAAQzB,OAAO6B,UAAkBJ,EAAQzB,WAAa8B,MAAMC,KAAKN,EAAQzB,QAEpE,QAAbgC,KAAKL,OACM,SAAU,aAAeK,KAAKC,aAAeD,KAAKE,gBACzC,OAAbF,KAAKL,UACPM,kBAEAC,+EAKJN,KAAKtB,IAAI,cACPK,IAAMO,EAAGN,QAAUM,EAAGN,QAAQD,IAAMO,EAAGL,aAAa,cACpDW,MAAH,OAAqBN,EAAGM,MAAM,0BAA4BW,EAAKV,QAAQC,qEAKtEU,UAAYJ,KAAKP,QAAQW,0BAChBJ,KAAKJ,MAAMS,KAAK,cACnB/B,IAAI,SAACC,EAAO+B,KACVV,KAAKU,GAAO3B,IAAM4B,EAAKC,WAAWjC,uCAK3CkC,EAAQf,MACRgB,GAAMD,EAAOE,WAAW,QACxBC,YAAc,GAAK,EAAIlB,OACtB,GAAImB,IAAKnB,EAAMmB,GAAKnB,EAAMmB,GAAK,MAC3B,GAAIC,IAAKpB,EAAMoB,GAAKpB,EAAMoB,GAAK,IAC5BC,UAAUN,EAAQK,EAAGD,GACrBC,GAAK,GAAKD,GAAK,GAAGH,EAAIK,UAAUN,IAAUK,EAAI,KAAMD,EAAI,MAGhED,YAAc,qCAGXrC,MACHkC,GAAStB,SAASC,cAAc,UAChCsB,EAAMD,EAAOE,WAAW,eAErBK,MAAQzC,EAAMyC,QACdC,OAAS1C,EAAM0C,SAClBF,UAAUxC,EAAO,EAAG,QACnB2C,QAAQT,EAAQT,KAAKN,MACnBe,EAAOU,UAAUnB,KAAKI"}